<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Register Item</title>
<style>
body { font-family: Arial; padding: 20px; }
form { max-width: 400px; margin: auto; }
label { display: block; margin-top: 10px; }
input, button { width: 100%; padding: 10px; margin-top: 5px; border:1px solid #ccc; border-radius:5px;}
button { background:#004080; color:white; cursor:pointer; }
#qrContainer { text-align:center; margin-top:20px; }
#emailNotice { color:green; font-weight:bold; text-align:center; margin-top:10px; }
</style>
</head>
<body>
<h1>Register Item</h1>

<form id="registerForm">
  <label>Full Name</label>
  <input type="text" id="name" required>

  <label>University Email</label>
  <input type="email" id="email" placeholder="name@universityofbohol.edu.ph" required>

  <label>Item Name</label>
  <input type="text" id="item" required>

  <button type="submit">Register</button>
</form>

<div id="qrContainer"></div>
<p id="emailNotice"></p>

<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyAgDbyZ5koffA_M60oS9x6aaI_UyViLZVw",
  authDomain: "lost-item-qr.firebaseapp.com",
  databaseURL: "https://lost-item-qr-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "lost-item-qr",
  storageBucket: "lost-item-qr.firebasestorage.app",
  messagingSenderId: "1026817510307",
  appId: "1:1026817510307:web:9a67340577a04797912816",
  measurementId: "G-QY02LG8PCX"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

function generateQR(text, containerId) {
  const container = document.getElementById(containerId);
  container.innerHTML = "<h3>Your QR Code:</h3>";
  const canvas = document.createElement("canvas");
  container.appendChild(canvas);

  QRCode.toCanvas(canvas, text, { width: 150 }, function(error) {
    if (error) console.error(error);
    else console.log("‚úÖ QR code generated!");
  });
}

document.getElementById("registerForm").addEventListener("submit", function(e){
  e.preventDefault();

  const name = document.getElementById("name").value.trim();
  const email = document.getElementById("email").value.trim();
  const item = document.getElementById("item").value.trim();

  if(!email.endsWith("@universityofbohol.edu.ph")){
    alert("‚ùå Please use your University of Bohol email.");
    return;
  }

  const id = Date.now();
  const newItem = {id, name, email, item, status:"Registered", newRegistration:true, reportedFound:false};

  db.ref("lostItems/"+id).set(newItem)
    .then(()=>{
      const qrLink = window.location.origin + "/report.html?item=" + id;
      generateQR(qrLink, "qrContainer");

      document.getElementById("emailNotice").innerText =
        `üìß Item registered! QR code generated for scanning.`;

      document.getElementById("registerForm").reset();
    })
    .catch(err => alert("‚ùå Error: " + err));
});
</script>
</body>
</html>
