<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Found Item Report</title>
<style>
body { font-family: Arial; padding: 20px; }
h1 { color: #004080; text-align: center; }
.card { border:1px solid #ccc; padding:20px; border-radius:8px; margin-top: 20px; }
button { padding:10px; background:green; color:white; border:none; border-radius:5px; cursor:pointer; }
#emailNotice { margin-top: 15px; font-weight: bold; color: blue; text-align:center; }
</style>
</head>
<body>
<h1>Item Information</h1>
<div id="itemCard"></div>
<p id="emailNotice"></p>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyAgDbyZ5koffA_M60oS9x6aaI_UyViLZVw",
  authDomain: "lost-item-qr.firebaseapp.com",
  databaseURL: "https://lost-item-qr-default-rtdb.firebaseio.com",
  projectId: "lost-item-qr",
  storageBucket: "lost-item-qr.appspot.com",
  messagingSenderId: "1026817510307",
  appId: "1:1026817510307:web:9a67340577a04797912816",
  measurementId: "G-QY02LG8PCX"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// Get item ID from QR URL
const params = new URLSearchParams(window.location.search);
const itemId = params.get("item");

// Fetch item data from Firebase
db.ref("lostItems/"+itemId).once("value").then(snapshot => {
  const item = snapshot.val();
  if(!item){
    document.getElementById("itemCard").innerHTML="<p>‚ùå Item not found.</p>";
    return;
  }

  document.getElementById("itemCard").innerHTML = `
    <div class="card">
      <h3>${item.item}</h3>
      <p>Owner: ${item.name} <br>Email: ${item.email}</p>
      <p>Status: ${item.status}</p>
      <button id="reportBtn">üì¢ Report as Found</button>
    </div>
  `;

  // Report Found button
  document.getElementById("reportBtn").addEventListener("click", () => {
    db.ref("lostItems/"+itemId).update({status:"Reported Found"})
      .then(()=>{
        // Simulate sending email to owner
        document.getElementById("emailNotice").innerText = `üìß Notification sent to ${item.email} (simulated)`;
        alert(`‚úÖ Report submitted! ${item.name} will be notified.`);
        location.reload(); // reload to update status
      })
      .catch(err => alert("‚ùå Error: "+err));
  });
});
</script>
</body>
</html>
